try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="2dccdffe-493b-4b03-a9f9-28f1e6dec06e",e._sentryDebugIdIdentifier="sentry-dbid-2dccdffe-493b-4b03-a9f9-28f1e6dec06e")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4940,8013],{20394:(e,t,n)=>{n.d(t,{createClient:()=>i});var r=n(31414),s=n(84177),o=n(45518);let i=()=>{var e,t,n;return(null==(e=window)?void 0:e.paywallExtensionId)&&(null==(n=window)||null==(t=n.chrome)?void 0:t.runtime)?(0,o.UU)("https://api.captain.software","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1uaG9wcHdhanJxYmZod3R5aXZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTI3MzQ5MjQsImV4cCI6MjAyODMxMDkyNH0.-_70PEJOVst49q8oYxFOj3hgCegbCaYewmGa1umuOU0",{auth:{storage:s.w,flowType:"pkce"}}):(0,r.createBrowserClient)("https://api.captain.software","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1uaG9wcHdhanJxYmZod3R5aXZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTI3MzQ5MjQsImV4cCI6MjAyODMxMDkyNH0.-_70PEJOVst49q8oYxFOj3hgCegbCaYewmGa1umuOU0",{cookieOptions:{sameSite:"none",secure:!0}})}},51195:(e,t,n)=>{function r(){try{return window.self!==window.top}catch(e){return!0}}function s(e){return new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}function o(e,t){let n=e/100;try{return new Intl.NumberFormat(void 0,{style:"currency",currency:t.toUpperCase()}).format(n)}catch(e){return"".concat(n.toFixed(2)," ").concat(t.toUpperCase())}}function i(e){return({day:"day",week:"week",month:"month",year:"year",daily:"day",weekly:"week",monthly:"month",yearly:"year",annual:"year"})[null==e?void 0:e.toLowerCase()]||e||"unknown"}n.d(t,{GZ:()=>r,Yq:()=>s,vv:()=>o,vy:()=>i})},57771:(e,t,n)=>{n.d(t,{A:()=>r});let r=(0,n(2078).createContext)(null)},68213:(e,t,n)=>{n.d(t,{Vm:()=>o,jo:()=>s,zN:()=>a});var r=n(51195);let s=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Date.now(),s="".concat("https://onlineapp.pro","/paywall/auth/start?").concat(e,"&v=").concat(n);(0,r.GZ)()?window.parent.postMessage({type:"redirect",redirectUrl:s},"*"):t?window.location.href=s:window.open(s,"_blank")};function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#000";if(e.startsWith("#"))return i(e);let t=window&&window.CSS&&window.CSS.supports("color: ".concat(e))?window.CSS.supports("color: ".concat(e),"color"):null;return!!t&&i(t)}function i(e){3===(e=e.replace("#","")).length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]);let t=parseInt(e.substring(0,2),16),n=parseInt(e.substring(2,4),16);return(299*t+587*n+114*parseInt(e.substring(4,6),16))/1e3/255<.6}let a=(e,t,n)=>{n?console.log("[PAYWALL #".concat(t,"]"),e,n):console.log("[PAYWALL #".concat(t,"]"),e)}},84177:(e,t,n)=>{n.d(t,{w:()=>r});let r={refreshTimer:null,refreshInterval:36e5,changeListeners:new Set,port:null,portMessageHandler:null,cache:new Map,cacheInitialized:!1,initConnection(){if(!window.chrome||!window.chrome.runtime)return void console.warn("Chrome API is not available for connection, please check your background script and manifest.json following the documentation.");if(!window.paywallExtensionId)return void console.warn("Chrome API is available, but Paywall Extension ID is not set, please edit paywall settings.");try{this.port=window.chrome.runtime.connect(window.paywallExtensionId,{name:"supabase-auth-adapter"}),this.portMessageHandler=e=>{if(e&&"storage_update"===e.type){let{action:t,key:n,value:r,timestamp:s}=e;n&&t&&("set"===t&&void 0!==r?this.cache.set(n,r):"remove"===t&&this.cache.delete(n),this.notifyChange("set"===t?"set":"remove",n,r,s))}},this.port.onMessage.addListener(this.portMessageHandler),this.port.onDisconnect.addListener(()=>{this.port=null,setTimeout(()=>this.initConnection(),5e3)})}catch(e){console.error("Error connecting to extension:",e),this.port=null,setTimeout(()=>this.initConnection(),5e3)}},onChanged(e){0!==this.changeListeners.size||this.port||this.initConnection(),this.changeListeners.add(e)},offChanged(e){this.changeListeners.delete(e),0===this.changeListeners.size&&this.port&&(this.port.disconnect(),this.port=null)},notifyChange(e,t,n,r){let s={type:e,key:t,value:n,timestamp:r};this.changeListeners.forEach(e=>{try{e(s)}catch(e){console.error("Error in onChanged handler:",e)}})},sendMessage:async(e,t)=>new Promise((n,r)=>{let s=window.chrome;if(void 0===s||!s.runtime)return void r(Error("Chrome API is not available"));try{s.runtime.sendMessage(window.paywallExtensionId,{action:e,data:t,source:"supabase-auth-adapter"},t=>s.runtime.lastError?void r(Error(String(s.runtime.lastError.message||"Unknown Chrome error"))):t&&"error"===t.status?void r(Error(String(t.message)||"Unknown error")):void("getItem"===e?n((null==t?void 0:t.value)||null):n(t)))}catch(e){r(e)}}),async broadcast(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.sendMessage("broadcast",{type:"broadcast",message:e,timestamp:Date.now(),...t})},async initCache(){if(!this.cacheInitialized)try{let e=await this.sendMessage("getItem",{key:"access_token"});null!==e&&this.cache.set("access_token",String(e));let t=await this.sendMessage("getItem",{key:"refresh_token"});null!==t&&this.cache.set("refresh_token",String(t)),this.cacheInitialized=!0,t&&this.startSessionRefresh()}catch(e){console.error("Error initializing cache:",e)}},async getItem(e){if(this.cacheInitialized&&this.cache.has(e))return this.cache.get(e)||null;try{let t=await this.sendMessage("getItem",{key:e});return null!==t?this.cache.set(e,String(t)):this.cache.delete(e),null!==t?String(t):null}catch(e){return console.error("Error during getting data from extension: 1. Please check your background script following paywall install instructions. 2. Please double check extension ID specified in paywall settings match ID in chrome://extensions/ tab: ",e),null}},getItemSync(e){return this.cacheInitialized||console.warn("Cache not initialized, getItemSync may return incorrect results"),this.cache.has(e)&&this.cache.get(e)||null},setItem:(e,t)=>{r.cache.set(e,t),r.sendMessage("setItem",{key:e,value:t}).catch(e=>{console.error("Error during saving data to extension:",e)})},removeItem:e=>{r.cache.delete(e),r.sendMessage("removeItem",{key:e}).catch(e=>{console.error("Error during removing data from extension:",e)})},async saveAllTokens(e){try{for(let[t,n]of Object.entries(e))this.cache.set(t,n);for(let[t,n]of Object.entries(e))await this.sendMessage("setItem",{key:t,value:n});console.log("All tokens successfully saved in extension")}catch(e){console.error("Error during saving all tokens:",e)}},startSessionRefresh(){this.refreshTimer&&clearInterval(this.refreshTimer),this.refreshTimer=setInterval(()=>{this.refreshSession().catch(e=>{console.error("Error during scheduled session refresh:",e)})},this.refreshInterval),console.log("Session refresh scheduled every ".concat(this.refreshInterval/6e4," minutes"))},stopSessionRefresh(){this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null,console.log("Session refresh stopped"))},async refreshSession(){try{let e=await this.getItem("refresh_token");if(!e)return console.error("Refresh token not found"),!1;let{createClient:t}=await Promise.all([n.e(1414),n.e(8013)]).then(n.bind(n,20394)),r=t(),{data:s,error:o}=await r.auth.refreshSession({refresh_token:e});if(o)return console.error("Error refreshing session:",o),!1;if(!(null==s?void 0:s.session))return console.error("No session returned after refresh"),!1;return await this.saveAllTokens({access_token:s.session.access_token,refresh_token:s.session.refresh_token}),console.log("Session successfully refreshed"),!0}catch(e){return console.error("Error during session refresh:",e),!1}},async getTokens(){return{access_token:await this.getItem("access_token")||void 0,refresh_token:await this.getItem("refresh_token")||void 0}},async clearTokens(){this.removeItem("access_token"),this.removeItem("refresh_token"),this.stopSessionRefresh()},async ping(){try{let e=await this.sendMessage("ping",{});if(e&&"object"==typeof e&&"status"in e&&"ok"===e.status)return!this.port&&this.changeListeners.size>0&&this.initConnection(),this.cacheInitialized||this.initCache().catch(e=>{console.error("Error initializing cache during ping:",e)}),!0;return!1}catch(e){return console.error("Extension ping failed:",e),!1}}}}}]);